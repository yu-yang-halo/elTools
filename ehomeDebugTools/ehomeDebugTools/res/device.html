<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html>
    <head>
        <meta charset="utf-8">
            <meta name="viewport" content="width=device-width,maximum-scale=1,user-scalable=no"/>
            <script type="text/javascript" src="js/elapi.js" ></script>
            <script type="text/javascript" src="js/jquery-2.1.0.js" ></script>
            <title>设备列表</title>
            <link rel="stylesheet" href="css/button.css" type="text/css" charset="utf-8"/>
            <link rel="stylesheet" href="css/device.css" type="text/css" charset="utf-8"/>
            <title></title>
            </head>
    <body>

        <div class="deviceDetail">
          
          <div class="page1" >

              <div class="devstatus">
              	 <img class="onlineImg" src="img/icon_online.png"></img>
              	 <label class="onlineText">在线</label>
              </div>
              <div class="main">
              		<div class="topshow" style="display: none;"></div>
              	    <div class="centershow" style="display: none;"></div>
              	    <div class="bottomshow" style="display: none;"></div>
              </div>
          </div>
          <div class="page2" style="display:none;" >
             <div class="configHeader">
              	<label>基本信息配置</label>
             </div>
             <div class="configBody">
             	
             
             	
             	
             </div>
            
             
          </div>
          
          <div class="rounds">
              <a href="#" class="round" id="r1">●</a>
              <a href="#" class="round" id="r2">●</a>
           </div>
          
        </div>
        
        
    </body>
    <script type="text/javascript">
        $(document).ready(function(){
                          //hyl_requestDeviceInfo();
var device={"bindVmId":0,"connType":0,"locId":0,"ccsClientId":5295,"gatewayId":0,"accessYN":false,"objectId":231,"clientSn":"0010002101816",
"fieldMap":{"113":"0","111":"1","112":"0","114":"4","115":"$110"},"classId":11,"name":"开发板电源","netState":0};
    	//var clazz={"3":[{"displayName":"剩余电量","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":23,"presistYN":true,"fieldName":"battery"},{"displayName":"安装位置","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":false,"fieldId":24,"presistYN":true,"fieldName":"location"},{"displayName":"警报","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":21,"presistYN":false,"fieldName":"alert"},{"displayName":"开关状态","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":22,"presistYN":false,"fieldName":"status"},{"displayName":"test","aggrMethod":0,"dataType":1,"tsYN":true,"deviceCmdYN":false,"deviceStateYN":false,"fieldId":260,"presistYN":true,"fieldName":"test"}],"1":[],"7":[{"displayName":"剩余电量","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":72,"presistYN":true,"fieldName":"battery"},{"displayName":"警报","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":71,"presistYN":false,"fieldName":"alert"},{"displayName":"温度","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":73,"presistYN":false,"fieldName":"temp"},{"displayName":"安装位置","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":false,"fieldId":74,"presistYN":true,"fieldName":"location"}],"100":[{"displayName":"按钮2","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":122,"presistYN":false,"fieldName":"button2"},{"displayName":"Led开关","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":true,"deviceStateYN":false,"fieldId":123,"presistYN":false,"fieldName":"ledswitch"},{"displayName":"按钮1","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":121,"presistYN":false,"fieldName":"button1"},{"displayName":"温度","aggrMethod":0,"dataType":1,"tsYN":true,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":120,"presistYN":false,"fieldName":"temp"},{"displayName":"串口","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":true,"deviceStateYN":false,"fieldId":124,"presistYN":false,"fieldName":"serialport"}],"101":[{"displayName":"配置","aggrMethod":0,"dataType":4,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":false,"fieldId":125,"presistYN":true,"fieldName":"位置"},{"displayName":"按钮1","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":126,"presistYN":false,"fieldName":"bt1"},{"displayName":"串口","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":true,"deviceStateYN":false,"fieldId":138,"presistYN":false,"fieldName":"serialport"},{"displayName":"按钮2","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":136,"presistYN":false,"fieldName":"bt2"},{"displayName":"开关控制","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":true,"deviceStateYN":false,"fieldId":127,"presistYN":false,"fieldName":"ledswitch"},{"displayName":"温度","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":137,"presistYN":false,"fieldName":"temp"}],"11":[{"displayName":"定时开关","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":false,"fieldId":114,"presistYN":true,"fieldName":"savemode"},{"displayName":"安装位置","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":true,"deviceStateYN":true,"fieldId":113,"presistYN":true,"fieldName":"location"},{"displayName":"开关","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":true,"deviceStateYN":false,"fieldId":112,"presistYN":false,"fieldName":"switch"},{"displayName":"价格","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":false,"fieldId":115,"presistYN":true,"fieldName":"price"},{"displayName":"状态","aggrMethod":0,"dataType":1,"tsYN":false,"deviceCmdYN":false,"deviceStateYN":true,"fieldId":111,"presistYN":false,"fieldName":"status"}]};
    	var clazz={"11":[{"displayName":"定时开关","aggrMethod":0,"dataType":1,
    	"tsYN":false,"deviceCmdYN":true,"deviceStateYN":false,"fieldId":114,
    	"presistYN":true,"fieldName":"savemode"},
    	{"displayName":"安装位置","aggrMethod":0,"dataType":1,"tsYN":false,
    	"deviceCmdYN":false,"deviceStateYN":true,"fieldId":113,"presistYN":false,
    	"fieldName":"location"},{"displayName":"开关","aggrMethod":0,"dataType":1,
    	"tsYN":false,"deviceCmdYN":true,"deviceStateYN":true,"fieldId":112,
    	"presistYN":false,"fieldName":"switch"},{"displayName":"价格","aggrMethod":0,"dataType":1,
    	"tsYN":false,"deviceCmdYN":false,"deviceStateYN":false,"fieldId":115,"presistYN":true,
    	"fieldName":"price"},{"displayName":"状态","aggrMethod":0,"dataType":1,"tsYN":false,
    	"deviceCmdYN":false,"deviceStateYN":false,"fieldId":111,"presistYN":true,"fieldName":"status"}]};
    	
                          loadDeviceInfoToHtml(device,clazz);
                        })
    
    function loadDeviceInfoToHtml(device,clazz){
    	
    	var configHtml="";
    	
    	var fieldValues=device.fieldMap;
    	var count=0;
    	for(var key in fieldValues){
    		var field=findFieldByFieldId(key,clazz[device.classId]);
    		
    		if(field.deviceCmdYN&&field.deviceStateYN){
    			//是button，发送命令且表状态
    			var htmlString="<input type='image' class='cmdStateBtn' src='img/bg_switch_on.png' value="+(++count)+" ></input>";
    			$(".centershow").show();
    			$(".centershow").append(htmlString);
    			
    		}else if(field.deviceStateYN){
    		     //是显示标签 表状态
    		    var htmlString="<img></img>";
    			$(".topshow").show();
    			$(".topshow").append(htmlString); 
    		     
    		}else if(field.deviceCmdYN){
    			//是按钮，发送命令，不表状态
    		    var htmlString="<button class='button blue'>CMD</button>";
    			$(".bottomshow").show();
    			$(".bottomshow").append(htmlString); 
    		
    		}else if(field.presistYN){
    		     //表配置存储，input框，放在第二界面
    		     configHtml+="<div class='configRow'><label>"+field.displayName
    		     +"</label><input value="+fieldValues[key]+" fieldId="+key+"></input> </div>";
    		     
    		}
    		
    		
    	}
        $(".configBody").append("<div class='configRow'><label>名称</label><input value="+device.name+"></input> </div>");
        $(".configBody").append(configHtml);   
    	$(".configBody").append(" <div class='configRow'><button class='button orange'  id='configBtn' objectid="+device.objectId+">保存</button></div>");
         
        $("#configBtn").click(function(){
         	var objectId=$(this).attr('objectid');
         	
         	$(".configRow input").each(function(){
         		if($(this).attr("fieldId")==undefined){
         			alert($(this).attr("value"));
         		}else{
         			alert($(this).attr("fieldId")+":"+$(this).attr("value"));
         		    //hyl_setFieldCmd($(this).attr("value"),$(this).attr("fieldId"),objectId);
         		}
         		
         		
         	});
         	
         });
       
    }
    
    
    function configInfoSaving(e){
    	
    }
    function load (){
        
        document.addEventListener('touchstart',touch, false);
        document.addEventListener('touchmove',touch, false);
        document.addEventListener('touchend',touch, false);
        var startPoint;
        var endPoint;
        var sel="#55ff00";
        var insel="#445566";
        function touch (event){
            var event = event || window.event;
            
            switch(event.type){
                case "touchstart":
                startPoint={x:event.touches[0].clientX,y:event.touches[0].clientY};
                
                break;
                case "touchend":
                
                endPoint={x:event.changedTouches[0].clientX,y:event.changedTouches[0].clientY};
                
                
                if(endPoint.x-startPoint.x>=50){
                    $(".page1").show();
                    $(".page2").hide();
                    
                    
                    
                    $("#r1").css("color",sel);
                    $("#r2").css("color",insel);
                    
                    
                    //alert('向右滑动');
                }
                if(endPoint.x-startPoint.x<=-50){
                   // alert('向左滑动');
                    $(".page1").hide();
                    $(".page2").show();
                    $("#r1").css("color",insel);
                    $("#r2").css("color",sel);
                }
                
                break;
                case "touchmove":
                event.preventDefault();
                
                break;
            }
            
        }
    }
    window.addEventListener('load',load, false);
    
        
    </script>
</html>
