<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <meta charset="utf-8">
            <meta name="viewport" content="width=device-width,maximum-scale=1,user-scalable=no"/>
            <script type="text/javascript" src="js/elapi.js" ></script>
            <script type="text/javascript" src="js/jquery-2.1.0.js" ></script>
            <title>设备列表</title>
            <link rel="stylesheet" href="css/button.css" type="text/css" charset="utf-8"/>
            <link rel="stylesheet" href="css/device.css" type="text/css" charset="utf-8"/>
             <link rel="stylesheet" href="config/config.css" type="text/css" charset="utf-8"/>
            <title></title>
            <style type="text/css">
                
             </style>
    </head>
    <body>
        
        <div class="appTheme">
            
            <div class="page1" >
                
                <div class="devstatus">
                    <span>
                        <img class="onlineImg" src="img/icon_online.png"></img>
                        <label class="onlineText">在线</label></span>
                    
                </div>
                <div class="topshow"  style="display: none;">
                    
                </div>
                <div class="centershow" style="display: none;">
                    <span></span>
                </div>
                <div class="bottomshow" style="display: none;">
                    <span></span>
                </div>
            </div>
            <div class="page2" style="display:none;" >
                <div class="configHeader">
                    <span><label>基本信息配置</label><span>
                </div>
                <div class="configBody">
                    
                    
                    
                    
                </div>
                
                
            </div>
        </div>
        
        
    </body>
    <script type="text/javascript">
        $(document).ready(function(){
                          hyl_requestDeviceInfo();
                          })
                          
                          function segmentToSelectedIndex(selectedIndex){
                              
                              switch(selectedIndex){
                                  case 0:
                                        $(".page1").show();
                                        $(".page2").hide();

                                        break;
                                  case 1:
                                        $(".page2").show();
                                        $(".page1").hide();
                                        break;
                              }
                              
                          }
                          
                          
                          function autoBuildHtml(device,clazz){
                              var configHtml="";
                              
                              var fieldValues=device.fieldMap;
                              
                              var fields=clazz[device.classId];
                              for(var j=0;j<fields.length;j++){
                                  var field=fields[j];
                                  var isExist=fieldIsExistInFieldMap(field,fieldValues);
                                  var defaultVal;
                                  var key=field.fieldId;
                                  if(isExist){
                                      defaultVal=fieldValues[key];
                                  }else{
                                      defaultVal=field.defaultValue;
                                  }
                                  
                                  switch(field.widget){
                                       case 1://是按钮，发送命令，不表状态
                                       var htmlString="<button class='button blue'   value='"+defaultVal+"' fieldId="+key+" objectid="+device.objectId+">"+field.displayName+"</button>";
                                       
                                       
                                       if(field.icon!=undefined){
                                           htmlString="<button class='button blue'   value='"+defaultVal+"' fieldId="+key+" objectid="+device.objectId+"  style='background-image:url(../field/"+field.icon+")'>"+field.displayName+"</button>";
                                       }
                                       
                                       
                                       
                                       $(".bottomshow").show();
                                       $(".bottomshow span").append(htmlString);
                                       

                                             break;
                                       case 2://是button，发送命令且表状态
                                       var htmlString="<input type='image' class='cmdStateBtn'  ";
                                       if(defaultVal==0){
                                           htmlString+=" src='img/bg_switch_off.png' ";
                                       }else{
                                           htmlString+=" src='img/bg_switch_on.png' ";
                                       }
                                       
                                       
                                       htmlString+=" value='"+(defaultVal)
                                       +"' fieldId="+key+" objectId="
                                       +device.objectId+"></input>";
                                       
                                       
                                       
                                       
                                       
                                       $(".centershow").show();
                                       $(".centershow span").append(htmlString);

                                             break;
                                       case 3://表配置存储，input框，放在第二界面
                                       configHtml+="<div class='configRow'><label>"+field.displayName
                                       +"</label><input value='"+defaultVal+"' fieldId="+key+"></input> </div>";
                                      

                                             break;
                                       case 4://是显示标签 表状态
                                       var htmlString="<div class='drow'><div class='dcell'>"+field.displayName+"</div><div class='dcell'>"+(defaultVal==""?"---":defaultVal)+"</div></div>";
                                       
                                       
                                       $(".topshow").show();
                                       $(".topshow").append(htmlString);

                                             break;
                                       default:
                                             break;
                                  }
                                  
                                  
                              }
                              return configHtml;
                          }
    
    function loadDeviceInfoToHtml(device,clazz){
        
        
        
        $(".configBody").empty();
        
        $(".topshow").empty();
        $(".centershow span").empty();
        $(".bottomshow span").empty();
        
        
        //基本信息显示
        if(device.netState==0){
            $(".onlineImg").attr("src","img/icon_offline.png");
            $(".onlineText").html("离线");
        }else{
            $(".onlineImg").attr("src","img/icon_online.png");
            $(".onlineText").html("在线");
        }
        var configHtml=autoBuildHtml(device,clazz);
        
        
        $(".configBody").append("<div class='configRow'><label>名称</label><input value='"+device.name+"'></input> </div>");
        $(".configBody").append("<div class='configRow'><label>序列号</label><input value='"+device.clientSn+"' disabled='disabled'></input> </div>");
        
        $(".configBody").append(configHtml);
        
        $(".configBody").append(" <div class='configRow'><button class='button blue'  id='configBtn' objectid="+device.objectId+">保存</button></div>");
        
        $("#configBtn").click(function(){
                              var objectId=$(this).attr('objectid');
                              
                              $(".configRow input").each(function(){
    if($(this).attr("fieldId")==undefined&&$(this).attr('disabled')==undefined){
                                                         hyl_updateDeviceName($(this).val(),objectId);
                                                         }else if($(this).attr('disabled')==undefined){
                                                         hyl_setFieldCmd($(this).val(),$(this).attr("fieldId"),objectId);
                                                         }
                                                         
                                                         
                                                         });
                              
                              });
                              
                              $(".bottomshow button").each(function(){
                                                           $(this).click(function(){
                                                                         
 
        hyl_setFieldCmd($(this).attr("value"),$(this).attr("fieldId"),$(this).attr("objectId"));
                                                                         
                                                                         });
                                                           
                                                           });
                                                           $(".centershow input").each(function(){
                                                                                       $(this).click(function(){
                                                                                                     
                                                                                                     if($(this).attr("value")==0){
                                                                                                     $(this).attr("value","1");
                                                                                                     $(this).attr("src","img/bg_switch_on.png");
                                                                                                     }else{
                                                                                                     $(this).attr("value","0");
                                                                                                     $(this).attr("src","img/bg_switch_off.png");
                                                                                                     }
                                                                                                     
                                                                                                     hyl_setFieldCmd($(this).attr("value"),$(this).attr("fieldId"),$(this).attr("objectId"));
                                                                                                     
                                                                                                     });
                                                                                       
                                                                                       });
                                                                                       
    }
    
    
       
        </script>
</html>
